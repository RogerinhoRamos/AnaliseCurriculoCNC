<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Analisador de Curr√≠culos CNC</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfjs-dist/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .header-features {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .feature {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .upload-section {
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 15px;
            padding: 40px;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            border-color: #2980b9;
            background: #f8f9fa;
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #27ae60;
            background: #d5f4e6;
        }

        .upload-icon {
            font-size: 4rem;
            color: #3498db;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .upload-subtext {
            color: #7f8c8d;
            font-size: 1rem;
        }

        #fileInput {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            width: 0%;
            transition: width 0.3s ease;
        }

        .dashboard {
            padding: 40px;
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            text-align: center;
            border-left: 4px solid #3498db;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            display: block;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            font-weight: 500;
            margin-top: 5px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .candidate-table {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .table-header {
            background: #34495e;
            color: white;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ranking-info {
            margin-top: 10px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .category-legend {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-color.a {
            background: #f1c40f;
        }

        .legend-color.b {
            background: #95a5a6;
        }

        .legend-color.c {
            background: #e67e22;
        }

        .legend-color.d {
            background: #e74c3c;
        }

        .table-content {
            max-height: 600px;
            overflow-y: auto;
        }

        .table-header-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1.5fr 1.5fr 1fr 1fr 1.5fr;
            gap: 15px;
            padding: 15px 20px;
            background: #2c3e50;
            color: white;
            font-weight: 600;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .header-cell {
            font-size: 0.9rem;
            text-align: center;
        }

        .candidate-row {
            padding: 15px 20px;
            border-bottom: 1px solid #ecf0f1;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1.5fr 1.5fr 1fr 1fr 1.5fr;
            gap: 15px;
            align-items: center;
            transition: all 0.2s ease;
        }

        .candidate-row:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }

        .candidate-row.a {
            border-left: 4px solid #f1c40f;
            background: linear-gradient(90deg, #fff9e6, transparent);
        }

        .candidate-row.b {
            border-left: 4px solid #95a5a6;
            background: linear-gradient(90deg, #f8f9fa, transparent);
        }

        .candidate-row.c {
            border-left: 4px solid #e67e22;
            background: linear-gradient(90deg, #fef5f0, transparent);
        }

        .candidate-row.d {
            border-left: 4px solid #e74c3c;
            background: linear-gradient(90deg, #fdf2f2, transparent);
        }

        .candidate-name {
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .name-details {
            flex-grow: 1;
        }

        .main-name {
            font-size: 1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 2px;
        }

        .extra-info {
            font-size: 0.8rem;
            color: #7f8c8d;
            font-style: italic;
            margin-bottom: 2px;
        }

        .candidate-id {
            font-size: 0.75rem;
            color: #95a5a6;
            font-weight: normal;
        }

        .city-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .full-address {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 2px;
        }

        .rank-badge {
            background: #3498db;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .candidate-category {
            text-align: center;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .category-a {
            background: #f1c40f;
            color: white;
        }

        .category-b {
            background: #95a5a6;
            color: white;
        }

        .category-c {
            background: #e67e22;
            color: white;
        }

        .category-d {
            background: #e74c3c;
            color: white;
        }

        .candidate-score {
            text-align: center;
        }

        .score-badge {
            background: #ecf0f1;
            padding: 8px 12px;
            border-radius: 15px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.9rem;
        }

        .candidate-age, .candidate-city {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .experience-years {
            text-align: center;
            color: #8e44ad;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #ecf0f1;
            border-left: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .footer {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 25px 40px;
            margin-top: 0;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            text-align: center;
        }

        .copyright {
            font-size: 0.9rem;
            opacity: 0.9;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .year {
            font-weight: 600;
            color: #3498db;
        }

        .developer {
            color: #ecf0f1;
        }

        .developer strong {
            color: #f39c12;
            font-weight: 700;
        }

        .separator {
            color: #7f8c8d;
            font-weight: 300;
        }

        .tech {
            color: #95a5a6;
            font-size: 0.8rem;
            font-style: italic;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .filters {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 10px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        /* Multi-Select Filters */
        .multi-select {
            position: relative;
            min-width: 200px;
        }

        .select-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .select-display:hover {
            border-color: #3498db;
        }

        .dropdown-arrow {
            color: #7f8c8d;
            transition: transform 0.3s ease;
        }

        .multi-select.open .dropdown-arrow {
            transform: rotate(180deg);
        }

        .select-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 5px 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .multi-select.open .select-options {
            display: block;
        }

        .option-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s ease;
        }

        .option-item:hover {
            background: #f8f9fa;
        }

        .option-item input[type="checkbox"] {
            margin-right: 8px;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn-filter, .btn-reset {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-filter {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-filter:hover {
            background: linear-gradient(135deg, #2980b9, #3498db);
            transform: translateY(-1px);
        }

        .btn-reset {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .btn-reset:hover {
            background: #d5dbdb;
            transform: translateY(-1px);
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }

            .header-features {
                gap: 10px;
            }

            .feature {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
            
            .upload-section {
                padding: 20px;
            }
            
            .dashboard {
                padding: 20px;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .insights-grid {
                grid-template-columns: 1fr;
            }

            .category-tabs {
                flex-direction: column;
                align-items: stretch;
            }

            .tab-button {
                text-align: center;
                margin-bottom: 5px;
            }

            .table-header-row,
            .candidate-row {
                grid-template-columns: 1fr;
                gap: 10px;
                text-align: center;
                padding: 15px;
            }

            .table-header-row {
                display: none; /* Hide header on mobile for better UX */
            }

            .candidate-row {
                display: block;
                border: 1px solid #ecf0f1;
                border-radius: 10px;
                margin-bottom: 10px;
                padding: 15px;
            }

            .candidate-name {
                justify-content: center;
                margin-bottom: 10px;
                font-size: 1.1rem;
            }

            .candidate-row > div {
                margin-bottom: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .candidate-row > div::before {
                content: attr(data-label);
                font-weight: bold;
                color: #7f8c8d;
                font-size: 0.8rem;
            }

            .phase-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .phase-header h3 {
                font-size: 1.1rem;
            }

            .conclusion-points {
                gap: 10px;
            }

            .conclusion-item {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }

            .filters {
                flex-direction: column;
                gap: 15px;
            }

            .filter-group {
                width: 100%;
            }

            .multi-select {
                min-width: 100%;
            }

            .filter-actions {
                justify-content: center;
                width: 100%;
            }

            .btn-filter, .btn-reset {
                flex: 1;
                max-width: 150px;
            }

            .footer {
                padding: 20px;
            }

            .copyright {
                flex-direction: column;
                gap: 5px;
                font-size: 0.8rem;
            }

            .separator {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Analisador de Curr√≠culos CNC</h1>
            <p>An√°lise Din√¢mica para Preparadores e Operadores CNC</p>
            <div class="header-features">
                <span class="feature">üìÑ PDFs Individuais</span>
                <span class="feature">üìã PDFs Unificados</span>
                <span class="feature">ü§ñ An√°lise Autom√°tica</span>
            </div>
            <div style="margin-top: 15px;">
                <button onclick="runDiagnostic()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; backdrop-filter: blur(10px);">
                    üîß Testar Sistema
                </button>
            </div>
        </div>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÑ</div>
                <div class="upload-text">Clique ou arraste seus PDFs aqui</div>
                <div class="upload-subtext">Suporte para PDFs individuais ou unificados com m√∫ltiplos candidatos</div>
                <input type="file" id="fileInput" multiple accept=".pdf">
            </div>
            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <button class="btn" id="analyzeBtn" onclick="startAnalysis()" disabled>üöÄ Iniciar An√°lise</button>
            <button class="btn-debug" onclick="runDiagnostic()" style="margin-left: 10px; background: #95a5a6; color: white; border: none; padding: 10px 15px; border-radius: 5px; font-size: 0.9rem; cursor: pointer;">üîß Diagn√≥stico</button>
        </div>

        <div class="dashboard" id="dashboard">
            <div class="filters" id="filters">
                <div class="filter-group">
                    <label class="filter-label">Perfil:</label>
                    <div class="multi-select" id="profileFilter">
                        <div class="select-display">
                            <span class="selected-text">Todos os perfis</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="select-options">
                            <label class="option-item">
                                <input type="checkbox" value="" checked> Todos
                            </label>
                            <label class="option-item">
                                <input type="checkbox" value="preparador"> üîß Preparadores
                            </label>
                            <label class="option-item">
                                <input type="checkbox" value="operador"> ‚öôÔ∏è Operadores
                            </label>
                            <label class="option-item">
                                <input type="checkbox" value="mixed"> üîß‚öôÔ∏è Multifuncionais
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">M√°quina:</label>
                    <div class="multi-select" id="machineFilter">
                        <div class="select-display">
                            <span class="selected-text">Todas as m√°quinas</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="select-options">
                            <label class="option-item">
                                <input type="checkbox" value="" checked> Todas
                            </label>
                            <label class="option-item">
                                <input type="checkbox" value="torno"> üîß Torno CNC
                            </label>
                            <label class="option-item">
                                <input type="checkbox" value="centro"> ‚öôÔ∏è Centro de Usinagem
                            </label>
                            <label class="option-item">
                                <input type="checkbox" value="ambos"> üîß‚öôÔ∏è Ambos
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Cidade:</label>
                    <div class="multi-select" id="cityFilter">
                        <div class="select-display">
                            <span class="selected-text">Todas as cidades</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="select-options">
                            <label class="option-item">
                                <input type="checkbox" value="" checked> Todas
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Categoria:</label>
                    <div class="multi-select" id="categoryFilter">
                        <div class="select-display">
                            <span class="selected-text">Todas as categorias</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="select-options">
                            <label class="option-item">
                                <input type="checkbox" value="" checked> Todas
                            </label>
                            <label class="option-item">
                                <input type="checkbox" value="A"> ü•á Categoria A (Premium)
                            </label>
                            <label class="option-item">
                                <input type="checkbox" value="B"> ü•à Categoria B (S√≥lido)
                            </label>
                            <label class="option-item">
                                <input type="checkbox" value="C"> ü•â Categoria C (Potencial)
                            </label>
                            <label class="option-item">
                                <input type="checkbox" value="D"> üìã Categoria D (B√°sico)
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="filter-actions">
                    <button class="btn-filter" onclick="applyFilters()">üîç Filtrar</button>
                    <button class="btn-reset" onclick="resetFilters()">üîÑ Limpar</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="totalCandidates">0</span>
                    <div class="stat-label">Total de Candidatos</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="preparadorCount">0</span>
                    <div class="stat-label">Preparadores CNC</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="operadorCount">0</span>
                    <div class="stat-label">Operadores CNC</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="avgAge">0</span>
                    <div class="stat-label">Idade M√©dia</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="avgExperience">0</span>
                    <div class="stat-label">Anos Experi√™ncia M√©dia</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="versatileCount">0</span>
                    <div class="stat-label">Profissionais Vers√°teis</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="categoryACount">0</span>
                    <div class="stat-label">Categoria A (Premium)</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="regionalCount">0%</span>
                    <div class="stat-label">Concentra√ß√£o Regional</div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title">üìä Distribui√ß√£o por Perfil</div>
                    <canvas id="profileChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-title">üè≠ Tipo de M√°quina</div>
                    <canvas id="machineChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-title">üë• Distribui√ß√£o por Idade</div>
                    <canvas id="ageChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-title">üéì N√≠vel de Escolaridade</div>
                    <canvas id="educationChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-title">üìç Distribui√ß√£o Geogr√°fica</div>
                    <canvas id="locationChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-title">‚è±Ô∏è Experi√™ncia por Anos</div>
                    <canvas id="experienceChart"></canvas>
                </div>
            </div>

            <div class="candidate-table">
                <div class="table-header">
                    üë®‚Äçüíº Ranking de Candidatos por Score
                    <div class="ranking-info">
                        <span class="category-legend">
                            <span class="legend-item"><span class="legend-color a"></span>A: Premium (80+)</span>
                            <span class="legend-item"><span class="legend-color b"></span>B: S√≥lido (65-79)</span>
                            <span class="legend-item"><span class="legend-color c"></span>C: Potencial (50-64)</span>
                            <span class="legend-item"><span class="legend-color d"></span>D: B√°sico (&lt;50)</span>
                        </span>
                    </div>
                </div>
                <div class="table-content" id="candidateTable">
                    <!-- Tabela ser√° preenchida dinamicamente -->
                </div>
            </div>
        </div>

        <!-- Footer com Copyright -->
        <footer class="footer">
            <div class="footer-content">
                <p class="copyright">
                    <span class="year">¬© 2025</span>
                    <span class="separator">‚Ä¢</span>
                    <span class="developer">Desenvolvido por <strong>Rogerinho Ramos</strong></span>
                    <span class="separator">‚Ä¢</span>
                    <span class="tech">Analytics Tool & JavaScript</span>
                </p>
            </div>
        </footer>
    </div>

    <script>
        // Configura√ß√£o do PDF.js
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdfjs-dist/3.11.174/pdf.worker.min.js';
            console.log('‚úÖ PDF.js configurado');
        } else {
            console.error('‚ùå PDF.js n√£o carregado');
        }

        // Vari√°veis globais
        let analyzedData = [];
        let charts = {};

        // Teste de diagn√≥stico
        function runDiagnostic() {
            console.log('üîß DIAGN√ìSTICO COMPLETO DO SISTEMA:');
            console.log('=====================================');
            
            // Testar bibliotecas
            console.log('üìö BIBLIOTECAS:');
            console.log('PDF.js dispon√≠vel:', typeof pdfjsLib !== 'undefined' ? '‚úÖ' : '‚ùå');
            console.log('Chart.js dispon√≠vel:', typeof Chart !== 'undefined' ? '‚úÖ' : '‚ùå');
            
            if (typeof pdfjsLib !== 'undefined') {
                console.log('PDF.js vers√£o:', pdfjsLib.version || 'Desconhecida');
                console.log('Worker configurado:', pdfjsLib.GlobalWorkerOptions.workerSrc ? '‚úÖ' : '‚ùå');
            }
            
            // Testar elementos DOM
            console.log('\nüéØ ELEMENTOS DOM:');
            const elementos = [
                'uploadArea', 'fileInput', 'analyzeBtn', 'dashboard', 
                'progressBar', 'progressFill'
            ];
            
            let elementosOK = 0;
            elementos.forEach(id => {
                const elemento = document.getElementById(id);
                const status = elemento ? '‚úÖ' : '‚ùå';
                console.log(`#${id}: ${status}`);
                if (elemento) elementosOK++;
            });
            
            console.log(`\nüìä RESUMO: ${elementosOK}/${elementos.length} elementos encontrados`);
            
            // Testar vari√°veis globais
            console.log('\nüåê VARI√ÅVEIS GLOBAIS:');
            console.log('analyzedData:', Array.isArray(analyzedData) ? '‚úÖ Array' : '‚ùå');
            console.log('selectedFiles:', window.selectedFiles ? `‚úÖ ${window.selectedFiles.length} arquivo(s)` : '‚ùå Nenhum arquivo');
            
            console.log('\n=====================================');
            
            if (elementosOK === elementos.length && typeof pdfjsLib !== 'undefined') {
                console.log('üéâ SISTEMA FUNCIONANDO CORRETAMENTE!');
                alert('‚úÖ Sistema funcionando corretamente!\n\nTodos os componentes foram carregados. Voc√™ pode fazer upload dos PDFs.');
            } else {
                console.log('‚ö†Ô∏è PROBLEMAS DETECTADOS!');
                alert('‚ö†Ô∏è Problemas detectados!\n\nVerifique o console (F12) para mais detalhes.');
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM carregado, iniciando aplica√ß√£o...');
            
            // Executar diagn√≥stico
            setTimeout(() => {
                runDiagnostic();
                setupEventListeners();
                console.log('‚úÖ Aplica√ß√£o completamente carregada e pronta para uso!');
                
                // Mostrar mensagem de pronto para o usu√°rio
                const uploadText = document.querySelector('.upload-text');
                if (uploadText && !window.selectedFiles) {
                    uploadText.innerHTML = 'üìÑ Arraste seus PDFs aqui ou clique para selecionar<br><small style="opacity: 0.7;">Sistema carregado e pronto!</small>';
                }
            }, 500);
        });

        function setupEventListeners() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const analyzeBtn = document.getElementById('analyzeBtn');

            if (!uploadArea || !fileInput || !analyzeBtn) {
                console.error('‚ùå Elementos n√£o encontrados');
                return;
            }

            // Upload area click
            uploadArea.addEventListener('click', () => {
                console.log('üìÅ Clique na √°rea de upload');
                fileInput.click();
            });

            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
                console.log('üìÇ Arquivo sendo arrastado...');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files).filter(file => file.type === 'application/pdf');
                console.log(`üìÑ ${files.length} arquivo(s) PDF detectado(s)`);
                if (files.length) {
                    handleFiles(files);
                }
            });

            // File input change
            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                console.log(`üìÇ ${files.length} arquivo(s) selecionado(s)`);
                handleFiles(files);
            });

            // Analyze button
            analyzeBtn.addEventListener('click', () => {
                console.log('üîç Bot√£o analisar clicado');
                startAnalysis();
            });

            console.log('‚úÖ Event listeners configurados');
        }

        function handleFiles(files) {
            console.log('üìã Processando arquivos:', files.map(f => f.name));
            updateUploadUI(files);
            
            // Store files globally for analysis
            window.selectedFiles = files;
        }

        function setupMultiSelectFilters() {
            const multiSelects = document.querySelectorAll('.multi-select');
            
            multiSelects.forEach(select => {
                const display = select.querySelector('.select-display');
                const options = select.querySelector('.select-options');
                
                display.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // Close other open selects
                    document.querySelectorAll('.multi-select.open').forEach(s => {
                        if (s !== select) s.classList.remove('open');
                    });
                    select.classList.toggle('open');
                });
                
                options.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                // Handle checkbox changes
                const checkboxes = options.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        updateSelectDisplay(select);
                    });
                });
            });
            
            // Close selects when clicking outside
            document.addEventListener('click', () => {
                document.querySelectorAll('.multi-select.open').forEach(select => {
                    select.classList.remove('open');
                });
            });
        }

        function updateSelectDisplay(selectElement) {
            const display = selectElement.querySelector('.selected-text');
            const checkboxes = selectElement.querySelectorAll('input[type="checkbox"]:not([value=""])');
            const selectedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            
            if (selectedCount === 0) {
                const allCheckbox = selectElement.querySelector('input[value=""]');
                allCheckbox.checked = true;
                display.textContent = display.textContent.replace(/\d+ selecionado[s]?/, 'Todos');
            } else {
                const allCheckbox = selectElement.querySelector('input[value=""]');
                allCheckbox.checked = false;
                
                if (selectedCount === 1) {
                    const selectedCheckbox = Array.from(checkboxes).find(cb => cb.checked);
                    const label = selectedCheckbox.closest('.option-item').textContent.trim();
                    display.textContent = label;
                } else {
                    display.textContent = `${selectedCount} selecionado${selectedCount > 1 ? 's' : ''}`;
                }
            }
        }

        function populateFilters() {
            // Popular filtro de cidades
            const cities = [...new Set(analyzedData.map(c => c.city).filter(c => c))];
            const cityOptions = document.querySelector('#cityFilter .select-options');
            
            // Manter apenas a op√ß√£o "Todas"
            const allOption = cityOptions.querySelector('.option-item');
            cityOptions.innerHTML = '';
            cityOptions.appendChild(allOption);
            
            cities.sort().forEach(city => {
                const optionItem = document.createElement('label');
                optionItem.className = 'option-item';
                optionItem.innerHTML = `
                    <input type="checkbox" value="${city}"> ${city}
                `;
                cityOptions.appendChild(optionItem);
                
                // Add change listener
                const checkbox = optionItem.querySelector('input');
                checkbox.addEventListener('change', () => {
                    updateSelectDisplay(document.getElementById('cityFilter'));
                });
            });
        }

        function applyFilters() {
            const profileValues = getSelectedValues('profileFilter');
            const machineValues = getSelectedValues('machineFilter');
            const cityValues = getSelectedValues('cityFilter');
            const categoryValues = getSelectedValues('categoryFilter');
            
            // Apply filters to table rows
            const rows = document.querySelectorAll('.candidate-row');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const profile = row.getAttribute('data-profile');
                const machine = row.getAttribute('data-machine');
                const city = row.getAttribute('data-city');
                const category = row.getAttribute('data-category');
                
                const showProfile = profileValues.length === 0 || profileValues.includes(profile);
                const showMachine = machineValues.length === 0 || machineValues.includes(machine);
                const showCity = cityValues.length === 0 || cityValues.includes(city);
                const showCategory = categoryValues.length === 0 || categoryValues.includes(category);
                
                if (showProfile && showMachine && showCity && showCategory) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Update filter result message
            showFilterMessage(visibleCount);
        }

        function getSelectedValues(filterId) {
            const checkboxes = document.querySelectorAll(`#${filterId} input[type="checkbox"]:not([value=""]):checked`);
            return Array.from(checkboxes).map(cb => cb.value);
        }

        function resetFilters() {
            // Reset all checkboxes
            document.querySelectorAll('.multi-select input[type="checkbox"]').forEach(checkbox => {
                if (checkbox.value === '') {
                    checkbox.checked = true;
                } else {
                    checkbox.checked = false;
                }
            });
            
            // Update displays
            document.querySelectorAll('.multi-select').forEach(select => {
                updateSelectDisplay(select);
            });
            
            // Show all rows
            document.querySelectorAll('.candidate-row').forEach(row => {
                row.style.display = '';
            });
            
            // Hide filter message
            const filterMessage = document.querySelector('.filter-message');
            if (filterMessage) {
                filterMessage.remove();
            }
        }

        function showFilterMessage(visibleCount) {
            // Remove existing message
            const existingMessage = document.querySelector('.filter-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // Add new message
            const message = document.createElement('div');
            message.className = 'filter-message';
            message.innerHTML = `
                <div class="filter-result">
                    üîç Mostrando <strong>${visibleCount}</strong> de <strong>${analyzedData.length}</strong> candidatos
                    <button class="btn-clear-filter" onclick="resetFilters()">Limpar filtros</button>
                </div>
            `;
            
            const table = document.querySelector('.candidate-table');
            table.insertBefore(message, table.querySelector('.table-content'));
        }

        function updateUploadUI(files) {
            const uploadText = document.querySelector('.upload-text');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            if (files.length > 0) {
                if (files.length === 1) {
                    uploadText.textContent = `üìÑ ${files.length} arquivo selecionado (individual ou unificado)`;
                } else {
                    uploadText.textContent = `üìÑ ${files.length} arquivos selecionados (m√∫ltiplos PDFs)`;
                }
                analyzeBtn.disabled = false;
            } else {
                uploadText.textContent = 'Clique ou arraste seus PDFs aqui';
                analyzeBtn.disabled = true;
            }
        }

        async function startAnalysis() {
            console.log('üöÄ Iniciando an√°lise...');
            
            const files = window.selectedFiles || document.getElementById('fileInput').files;
            
            if (!files || files.length === 0) {
                alert('‚ö†Ô∏è Por favor, selecione pelo menos um arquivo PDF primeiro.');
                console.log('‚ùå Nenhum arquivo selecionado');
                return;
            }

            console.log(`üìä Analisando ${files.length} arquivo(s)...`);
            
            try {
                showLoading();
                analyzedData = []; // Reset data
                
                for (let i = 0; i < files.length; i++) {
                    console.log(`üìÑ Processando arquivo ${i + 1}/${files.length}: ${files[i].name}`);
                    await processFile(files[i], i + 1, files.length);
                }
                
                console.log(`‚úÖ Processamento conclu√≠do. ${analyzedData.length} candidatos extra√≠dos.`);
                
                if (analyzedData.length === 0) {
                    alert('‚ö†Ô∏è Nenhum candidato foi encontrado nos arquivos. Verifique se os PDFs cont√™m curr√≠culos v√°lidos.');
                    hideLoading();
                    return;
                }
                
                generateDashboard();
                showDashboard();
                console.log('üéâ Dashboard gerado com sucesso!');
                
            } catch (error) {
                console.error('‚ùå Erro durante a an√°lise:', error);
                alert(`‚ùå Erro ao processar os arquivos: ${error.message}`);
                hideLoading();
            }
        }

        function showLoading() {
            console.log('‚è≥ Mostrando loading...');
            const progressBar = document.getElementById('progressBar');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            if (progressBar) progressBar.style.display = 'block';
            if (analyzeBtn) analyzeBtn.disabled = true;
        }

        function hideLoading() {
            console.log('‚úÖ Ocultando loading...');
            const progressBar = document.getElementById('progressBar');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            if (progressBar) progressBar.style.display = 'none';
            if (analyzeBtn) analyzeBtn.disabled = false;
        }

        function updateProgress(current, total) {
            const progress = (current / total) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        async function processFile(file, index, total) {
            console.log(`üîÑ Processando arquivo: ${file.name} (${file.size} bytes)`);
            updateProgress(index - 0.5, total);

            try {
                // Verificar se √© PDF
                if (file.type !== 'application/pdf') {
                    console.warn(`‚ö†Ô∏è Arquivo ${file.name} n√£o √© PDF. Tipo: ${file.type}`);
                    return;
                }

                console.log('üìñ Lendo arquivo PDF...');
                const arrayBuffer = await file.arrayBuffer();
                console.log(`‚úÖ Arquivo lido: ${arrayBuffer.byteLength} bytes`);
                
                console.log('üîç Carregando PDF com PDF.js...');
                
                // Configura√ß√£o mais robusta do PDF.js
                const loadingTask = pdfjsLib.getDocument({
                    data: arrayBuffer,
                    cMapUrl: 'https://cdnjs.cloudflare.com/ajax/libs/pdfjs-dist/3.11.174/cmaps/',
                    cMapPacked: true,
                    standardFontDataUrl: 'https://cdnjs.cloudflare.com/ajax/libs/pdfjs-dist/3.11.174/standard_fonts/',
                    verbosity: 0 // Reduzir logs do PDF.js
                });
                
                const pdf = await loadingTask.promise;
                
                console.log(`üìÑ PDF carregado: ${pdf.numPages} p√°ginas`);
                
                let fullText = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    console.log(`üìÉ Extraindo texto da p√°gina ${i}/${pdf.numPages}`);
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\n';
                }

                console.log(`‚úÖ Texto extra√≠do: ${fullText.length} caracteres`);
                
                if (fullText.length < 100) {
                    console.warn(`‚ö†Ô∏è Texto muito curto extra√≠do do arquivo ${file.name}`);
                    return;
                }

                // Detectar se √© PDF unificado ou individual
                console.log('üîç Analisando estrutura do PDF...');
                const candidates = splitUnifiedPDF(fullText, file.name);
                
                if (candidates.length > 1) {
                    // PDF unificado - m√∫ltiplos candidatos
                    console.log(`üìã PDF unificado detectado: ${candidates.length} candidatos encontrados`);
                    console.log('üìù Candidatos identificados:', candidates.map(c => c.name || 'Nome n√£o identificado'));
                    
                    let validCandidates = 0;
                    candidates.forEach(candidateData => {
                        // Valida√ß√£o adicional do candidato
                        if (candidateData.name && 
                            candidateData.name.length > 2 && 
                            !isInvalidCandidateName(candidateData.name) &&
                            (candidateData.age > 0 || candidateData.experienceYears > 0 || candidateData.city)) {
                            analyzedData.push(candidateData);
                            validCandidates++;
                            console.log(`‚úÖ Candidato v√°lido: ${candidateData.name}`);
                        } else {
                            console.log(`‚ùå Candidato inv√°lido descartado: ${candidateData.name || 'sem nome'}`);
                        }
                    });
                    
                    console.log(`üìä ${validCandidates} candidatos v√°lidos adicionados`);
                } else {
                    // PDF individual - um candidato
                    console.log(`üìÑ PDF individual processado`);
                    const candidateData = extractCandidateInfo(fullText, file.name);
                    
                    if (candidateData.name && !isInvalidCandidateName(candidateData.name)) {
                        analyzedData.push(candidateData);
                        console.log(`‚úÖ Candidato individual v√°lido: ${candidateData.name}`);
                    } else {
                        console.log(`‚ùå Candidato individual inv√°lido: ${candidateData.name || 'sem nome'}`);
                    }
                }

            } catch (error) {
                console.error(`‚ùå Erro ao processar ${file.name}:`, error);
                alert(`Erro ao processar o arquivo ${file.name}: ${error.message}`);
            }

            updateProgress(index, total);
        }

        function isInvalidCandidateName(name) {
            const invalidPatterns = [
                /^(sp|s√£o paulo|brasileiro|experi√™ncia|cursos|forma√ß√£o|objetivo|resumo)$/i,
                /^[a-z\s]{1,5}$/i, // Palavras muito curtas
                /^(complementares|profissional|acad√™mica|qualifica√ß√µes|informa√ß√µes)$/i,
                /^\d+\.?\s*$/,  // Apenas n√∫meros
                /^[^\w\s]+$/,   // Apenas s√≠mbolos
            ];
            
            return invalidPatterns.some(pattern => pattern.test(name.trim()));
        }

            } catch (error) {
                console.error(`Erro ao processar ${file.name}:`, error);
            }

            updateProgress(index, total);
        }

        function splitUnifiedPDF(fullText, filename) {
            // Padr√µes mais espec√≠ficos para identificar in√≠cio de novo candidato
            const candidateSeparators = [
                // Padr√£o do seu PDF: "1. Nome Candidato Cand-12345"
                /(?=\n\d+\.\s+[A-Z√Å√ä√Ä√ç√ì√ö][a-z√°√™√†√≠√≥√∫√ß√£√µ\s]+\s+Cand-\d+)/g,
                // Nomes seguidos de dados pessoais
                /(?=\n[A-Z√Å√ä√Ä√ç√ì√ö][A-Z√Å√ä√Ä√ç√ì√ö√á√É√ï\s]{8,50}\n.*?(?:Brasileiro|Idade|anos|Data|Endere√ßo|Objetivo))/g,
                // Padr√£o de objetivo profissional
                /(?=Objetivo\s*Profissional|OBJETIVO)/gi,
                // IDs de candidatos
                /(?=.*?Cand-\d+)/g
            ];

            let candidates = [];
            let bestSplit = [fullText]; // Default: texto completo como um candidato

            // Tentar diferentes padr√µes de separa√ß√£o
            for (let separator of candidateSeparators) {
                const splits = fullText.split(separator).filter(section => {
                    const cleanSection = section.trim();
                    return cleanSection.length > 100 && 
                           (cleanSection.includes('anos') || cleanSection.includes('experi√™ncia') || cleanSection.includes('CNC'));
                });
                
                if (splits.length > bestSplit.length) {
                    bestSplit = splits;
                }
            }

            // M√©todo espec√≠fico para o formato do seu PDF
            if (bestSplit.length === 1) {
                // Procurar por padr√£o espec√≠fico "n√∫mero. Nome Cand-ID"
                const candidatePattern = /(\d+\.\s+[A-Z√Å√ä√Ä√ç√ì√ö][a-z√°√™√†√≠√≥√∫√ß√£√µ\s]+\s+Cand-\d+)/g;
                const candidateMatches = [...fullText.matchAll(candidatePattern)];
                
                if (candidateMatches.length > 1) {
                    console.log(`üîç Encontrados ${candidateMatches.length} padr√µes de candidato`);
                    
                    bestSplit = [];
                    const positions = candidateMatches.map(match => match.index);
                    
                    for (let i = 0; i < positions.length; i++) {
                        const start = positions[i];
                        const end = i === positions.length - 1 ? fullText.length : positions[i + 1];
                        const section = fullText.substring(start, end);
                        
                        if (section.trim().length > 50) {
                            bestSplit.push(section);
                        }
                    }
                }
            }

            // M√©todo alternativo: buscar por se√ß√µes de experi√™ncia
            if (bestSplit.length === 1) {
                const experiencePattern = /(?=.*(?:Experi√™ncia|EXPERI√äNCIA|anos|CNC|Operador|Preparador))/g;
                const sections = fullText.split(/(?=\n[A-Z√Å√ä√Ä√ç√ì√ö][A-Z√Å√ä√Ä√ç√ì√ö√á√É√ï\s]{10,50}\n)/g);
                
                const validSections = sections.filter(section => {
                    const s = section.trim();
                    return s.length > 100 && 
                           (s.includes('anos') || s.includes('CNC') || s.includes('experi√™ncia'));
                });
                
                if (validSections.length > bestSplit.length) {
                    bestSplit = validSections;
                }
            }

            console.log(`üîç Divis√£o final: ${bestSplit.length} se√ß√µes encontradas`);

            // Processar cada se√ß√£o como um candidato
            bestSplit.forEach((section, index) => {
                if (section.trim().length > 50) {
                    const candidateData = extractCandidateInfo(section, `${filename}_candidato_${index + 1}`);
                    
                    // Validar se realmente √© um candidato v√°lido
                    if (candidateData.name && 
                        candidateData.name.length > 3 && 
                        !candidateData.name.toLowerCase().includes('experi√™ncia') &&
                        !candidateData.name.toLowerCase().includes('brasileiro') &&
                        !candidateData.name.toLowerCase().includes('cursos')) {
                        candidates.push(candidateData);
                        console.log(`‚úÖ Candidato v√°lido: ${candidateData.name}`);
                    } else {
                        console.log(`‚ùå Se√ß√£o inv√°lida descartada: ${candidateData.name || 'sem nome'}`);
                    }
                }
            });

            return candidates;
        }

        function extractCandidateInfo(text, filename) {
            // Padr√µes de regex corrigidos e mais espec√≠ficos
            const patterns = {
                // Nomes mais espec√≠ficos - evitar capturar t√≠tulos/se√ß√µes
                name: /(?:^|\n)([A-Z√Å√ä√Ä√ç√ì√ö][a-z√°√™√†√≠√≥√∫√ß√£√µ]+(?:\s+[A-Z√Å√ä√Ä√ç√ì√ö][a-z√°√™√†√≠√≥√∫√ß√£√µ]*)*(?:\s+[A-Z√Å√ä√Ä√ç√ì√ö][a-z√°√™√†√≠√≥√∫√ß√£√µ]+)*)\s*(?:\n|‚Ä¢|Brasileiro|Casado|Solteiro|\d+\s*anos|Data|Endere√ßo|Rua|Objetivo)/gm,
                alternativeName: /\n([A-Z√Å√ä√Ä√ç√ì√ö][A-Z√Å√ä√Ä√ç√ì√ö√á√É√ï\s]{10,50})\n.*?(?:Brasileiro|anos|Casado|Solteiro|Objetivo)/,
                candidateId: /Cand-(\d+)/,
                age: /(\d{1,2})\s*anos(?:\s|,|\.)|Data.*?(\d{2})\/(\d{2})\/(\d{4})|Nascimento.*?(\d{2})\/(\d{2})\/(\d{4})|(\d{4})\s*[-‚Äì]\s*(Casado|Solteiro|Uni√£o)/i,
                // Cidades normalizadas
                city: /(Jundia√≠|V√°rzea Paulista|Campo Limpo(?:\s+Paulista|\s+Pta)?|Cajamar|Itupeva|Franco da Rocha|S√£o Paulo|Cabre√∫va|Louveira|Itatiba|Sorocaba|Campinas|Santos|Indaiatuba|Parelheiros)/i,
                // Endere√ßo mais espec√≠fico
                address: /(?:Endere√ßo|Rua|Avenida|Av\.|R\.)[\s:]*([^,\n]+(?:,\s*[^,\n]+)*)/i,
                profile: /(Preparador|Operador|PREPARADOR|OPERADOR|Prep\.?\s*Op\.?\s*CNC|Multifuncional|Setup|Preset)/gi,
                machines: /(Torno\s+CNC|Centro\s+de\s+Usinagem|Torno\s+Vertical|Torno\s+Horizontal|centro\s+de\s+usinagem|torno\s+cnc|CNC|Ret√≠fica|Fresadora|Mandriladora)/gi,
                education: /(Ensino\s+M√©dio|Superior|T√©cnico|Gradua√ß√£o|Engenharia|Tecn√≥logo|Bacharel)/i,
                experience: /(\d{4})\s*[-‚Äì]\s*(\d{4}|atual|presente|\w+)|Per√≠odo.*?(\d{1,2})\/(\d{4}).*?(\d{1,2})\/(\d{4})|(\d{2}\/\d{2}\/\d{4})\s*[-‚Äì]\s*(\d{2}\/\d{2}\/\d{4})/g,
                senaiCourse: /(SENAI|Senai).*?(Programa√ß√£o|Opera√ß√£o|Torno|Centro|Usinagem|CNC|Mec√¢nica)/gi,
                companies: /(ThyssenKrupp|SKF|Continental|Dana|Knorr|Sifco|Dexco|Klabin|Joyson|Alpino|Procter|Gamble)/gi
            };

            const candidate = {
                name: '',
                age: 0,
                city: '',
                profile: '',
                machineType: '',
                education: '',
                experienceYears: 0,
                candidateId: '',
                filename: filename,
                senaiCourses: 0,
                companies: [],
                score: 0,
                category: '',
                strengths: [],
                fullAddress: ''
            };

            // Extrair e validar nome com m√∫ltiplas estrat√©gias
            let validName = '';
            
            // Estrat√©gia 1: Buscar nomes t√≠picos brasileiros
            const nameMatches = text.match(patterns.name) || [];
            for (let nameMatch of nameMatches) {
                const cleanName = nameMatch.trim().replace(/[‚Ä¢\n\r\t]/g, ' ').replace(/\s+/g, ' ');
                
                // Validar se √© realmente um nome (n√£o palavras como "Brasileiro", "Experi√™ncia", etc.)
                if (isValidName(cleanName)) {
                    validName = cleanName;
                    break;
                }
            }
            
            // Estrat√©gia 2: Se n√£o encontrou, usar padr√£o alternativo
            if (!validName) {
                const altMatch = text.match(patterns.alternativeName);
                if (altMatch && isValidName(altMatch[1])) {
                    validName = altMatch[1].trim();
                }
            }
            
            // Normalizar nome
            if (validName) {
                candidate.name = normalizeName(validName);
            }

            // Extrair ID do candidato
            const idMatch = text.match(patterns.candidateId);
            if (idMatch) {
                candidate.candidateId = idMatch[1];
            }

            // Extrair idade com m√∫ltiplas estrat√©gias
            const ageMatch = text.match(patterns.age);
            if (ageMatch) {
                if (ageMatch[1]) {
                    const age = parseInt(ageMatch[1]);
                    if (age >= 16 && age <= 80) { // Validar idade razo√°vel
                        candidate.age = age;
                    }
                } else if (ageMatch[4]) {
                    const birthYear = parseInt(ageMatch[4]);
                    if (birthYear > 1940 && birthYear < 2010) {
                        candidate.age = 2025 - birthYear;
                    }
                }
            }

            // Extrair endere√ßo completo
            const addressMatch = text.match(patterns.address);
            if (addressMatch) {
                candidate.fullAddress = addressMatch[1].trim();
            }

            // Extrair e normalizar cidade
            const cityMatch = text.match(patterns.city);
            if (cityMatch) {
                candidate.city = normalizeCity(cityMatch[1]);
            } else if (candidate.fullAddress) {
                // Tentar extrair cidade do endere√ßo
                const cityFromAddress = extractCityFromAddress(candidate.fullAddress);
                if (cityFromAddress) {
                    candidate.city = cityFromAddress;
                }
            }

            // Determinar perfil com l√≥gica aprimorada
            const profileMatches = text.match(patterns.profile) || [];
            candidate.profile = determineProfile(profileMatches, text);

            // Determinar tipo de m√°quina
            const machineMatches = text.match(patterns.machines) || [];
            candidate.machineType = determineMachineType(machineMatches, text);

            // Extrair educa√ß√£o
            const educationMatch = text.match(patterns.education);
            if (educationMatch) {
                candidate.education = normalizeEducation(educationMatch[1]);
            } else if (text.toLowerCase().includes('m√©dio')) {
                candidate.education = 'Ensino M√©dio';
            }

            // Contar cursos SENAI
            const senaiMatches = text.match(patterns.senaiCourse) || [];
            candidate.senaiCourses = senaiMatches.length;
            if (candidate.senaiCourses > 2) {
                candidate.strengths.push('M√∫ltiplos Cursos SENAI');
            }

            // Extrair empresas relevantes
            const companyMatches = text.match(patterns.companies) || [];
            candidate.companies = [...new Set(companyMatches)];
            if (candidate.companies.length > 2) {
                candidate.strengths.push('Experi√™ncia Diversificada');
            }

            // Calcular experi√™ncia
            candidate.experienceYears = calculateExperience(text, patterns.experience);

            // Sistema de pontua√ß√£o e categoriza√ß√£o
            candidate.score = calculateCandidateScore(candidate);
            candidate.category = categorizeCandidateByScore(candidate);

            return candidate;
        }

        function isValidName(name) {
            const invalidNames = [
                'brasileiro', 'brasileira', 'casado', 'casada', 'solteiro', 'solteira',
                'experi√™ncia', 'profissional', 'forma√ß√£o', 'acad√™mica', 'cursos',
                'complementares', 'objetivo', 'resumo', 'qualifica√ß√µes', 'informa√ß√µes',
                'dados', 'pessoais', 'contato', 'telefone', 'email', 'endere√ßo',
                'nascimento', 'idade', 'anos', 'estado', 'civil', 'uni√£o', 'est√°vel'
            ];
            
            const nameLower = name.toLowerCase();
            
            // Verificar se cont√©m palavras inv√°lidas
            for (let invalid of invalidNames) {
                if (nameLower.includes(invalid)) {
                    return false;
                }
            }
            
            // Verificar se tem pelo menos 2 palavras e formato de nome
            const words = name.trim().split(/\s+/);
            if (words.length < 2) return false;
            
            // Verificar se cada palavra tem pelo menos 2 caracteres
            return words.every(word => word.length >= 2);
        }

        function normalizeName(name) {
            // Converter para formato adequado: Primeira letra mai√∫scula
            return name.toLowerCase().replace(/\b\w/g, l => l.toUpperCase())
                      .replace(/\s+/g, ' ').trim()
                      .split(' ').slice(0, 4).join(' '); // M√°ximo 4 palavras
        }

        function normalizeCity(city) {
            const cityNormalizations = {
                'campo limpo': 'Campo Limpo Paulista',
                'campo limpo paulista': 'Campo Limpo Paulista',
                'campo limpo pta': 'Campo Limpo Paulista',
                'v√°rzea paulista': 'V√°rzea Paulista',
                'varzea paulista': 'V√°rzea Paulista',
                'jundiai': 'Jundia√≠',
                'jundia√≠': 'Jundia√≠',
                'itupeva': 'Itupeva',
                'cajamar': 'Cajamar',
                'franco da rocha': 'Franco da Rocha',
                's√£o paulo': 'S√£o Paulo',
                'sao paulo': 'S√£o Paulo',
                'itatiba': 'Itatiba'
            };
            
            const cityLower = city.toLowerCase().trim();
            return cityNormalizations[cityLower] || city.trim();
        }

        function extractCityFromAddress(address) {
            const cities = [
                'Jundia√≠', 'V√°rzea Paulista', 'Campo Limpo Paulista', 
                'Cajamar', 'Itupeva', 'Franco da Rocha', 'S√£o Paulo',
                'Cabre√∫va', 'Louveira', 'Itatiba', 'Sorocaba'
            ];
            
            for (let city of cities) {
                if (address.toLowerCase().includes(city.toLowerCase())) {
                    return normalizeCity(city);
                }
            }
            return null;
        }

        function determineProfile(profileMatches, text) {
            const preparadorCount = profileMatches.filter(p => 
                p.toLowerCase().includes('preparador') || 
                p.toLowerCase().includes('prep') ||
                p.toLowerCase().includes('setup') ||
                p.toLowerCase().includes('preset')
            ).length;
            
            const operadorCount = profileMatches.filter(p => 
                p.toLowerCase().includes('operador') && !p.toLowerCase().includes('preparador')
            ).length;
            
            const multifuncionalCount = profileMatches.filter(p => 
                p.toLowerCase().includes('multifuncional')
            ).length;

            if (multifuncionalCount > 0 || (preparadorCount > 0 && operadorCount > 0)) {
                return 'mixed';
            } else if (preparadorCount > operadorCount || text.toLowerCase().includes('prepara√ß√£o')) {
                return 'preparador';
            } else if (operadorCount > 0 || text.toLowerCase().includes('opera√ß√£o')) {
                return 'operador';
            } else {
                return 'operador'; // Default mais comum
            }
        }

        function determineMachineType(machineMatches, text) {
            const tornoCount = machineMatches.filter(m => 
                m.toLowerCase().includes('torno')
            ).length;
            
            const centroCount = machineMatches.filter(m => 
                m.toLowerCase().includes('centro') || m.toLowerCase().includes('usinagem')
            ).length;

            if (tornoCount > 0 && centroCount > 0) {
                return 'ambos';
            } else if (tornoCount > centroCount && centroCount === 0) {
                return 'torno';
            } else if (centroCount > tornoCount && tornoCount === 0) {
                return 'centro';
            } else if (tornoCount > 0 || centroCount > 0) {
                return 'ambos';
            } else {
                return 'nao_especificado';
            }
        }

        function normalizeEducation(education) {
            const eduLower = education.toLowerCase();
            if (eduLower.includes('superior') || eduLower.includes('engenharia') || eduLower.includes('bacharel')) {
                return 'Superior';
            } else if (eduLower.includes('t√©cnico')) {
                return 'T√©cnico';
            } else {
                return 'Ensino M√©dio';
            }
        }

        function calculateExperience(text, experiencePattern) {
            let totalExperience = 0;
            let experienceMatches = [];
            let match;
            
            const experienceRegex = new RegExp(experiencePattern);
            while ((match = experienceRegex.exec(text)) !== null) {
                experienceMatches.push(match);
            }

            experienceMatches.forEach(match => {
                let startYear, endYear;
                
                if (match[1] && match[2]) {
                    startYear = parseInt(match[1]);
                    endYear = match[2] === 'atual' || match[2].toLowerCase().includes('presente') ? 2025 : parseInt(match[2]);
                } else if (match[3] && match[4] && match[5] && match[6]) {
                    startYear = parseInt(match[4]);
                    endYear = parseInt(match[6]);
                }
                
                if (startYear && endYear && endYear >= startYear && startYear > 1990 && startYear < 2025) {
                    const years = Math.min(endYear - startYear, 25);
                    if (years > 0) {
                        totalExperience += years;
                    }
                }
            });

            return Math.min(totalExperience, 30);
        }

        function calculateCandidateScore(candidate) {
            let score = 0;
            
            // Pontua√ß√£o por experi√™ncia (40% do score)
            if (candidate.experienceYears >= 20) score += 40;
            else if (candidate.experienceYears >= 15) score += 35;
            else if (candidate.experienceYears >= 10) score += 30;
            else if (candidate.experienceYears >= 5) score += 20;
            else if (candidate.experienceYears >= 2) score += 10;
            
            // Pontua√ß√£o por perfil (20% do score)
            if (candidate.profile === 'preparador') score += 20;
            else if (candidate.profile === 'mixed') score += 18;
            else if (candidate.profile === 'operador') score += 15;
            
            // Pontua√ß√£o por versatilidade (15% do score)
            if (candidate.machineType === 'ambos') {
                score += 15;
                if (!candidate.strengths.includes('Vers√°til')) {
                    candidate.strengths.push('Vers√°til');
                }
            } else if (candidate.machineType === 'centro') {
                score += 10;
            } else if (candidate.machineType === 'torno') {
                score += 8;
            }
            
            // Pontua√ß√£o por educa√ß√£o (15% do score)
            if (candidate.education === 'Superior') {
                score += 15;
                if (!candidate.strengths.includes('Forma√ß√£o Superior')) {
                    candidate.strengths.push('Forma√ß√£o Superior');
                }
            } else if (candidate.education === 'T√©cnico') {
                score += 10;
                if (!candidate.strengths.includes('Forma√ß√£o T√©cnica')) {
                    candidate.strengths.push('Forma√ß√£o T√©cnica');
                }
            } else if (candidate.education === 'Ensino M√©dio') {
                score += 5;
            }
            
            // Bonifica√ß√µes (10% do score)
            if (candidate.senaiCourses >= 3) {
                score += 5;
                if (!candidate.strengths.includes('M√∫ltiplos Cursos SENAI')) {
                    candidate.strengths.push('M√∫ltiplos Cursos SENAI');
                }
            }
            if (candidate.companies.length >= 3) {
                score += 3;
                if (!candidate.strengths.includes('Experi√™ncia Diversificada')) {
                    candidate.strengths.push('Experi√™ncia Diversificada');
                }
            }
            if (candidate.age >= 25 && candidate.age <= 40) {
                score += 2; // Idade ideal
            }
            
            return Math.round(score);
        }

        function categorizeCandidateByScore(candidate) {
            if (candidate.score >= 80) return 'A';
            else if (candidate.score >= 65) return 'B';
            else if (candidate.score >= 50) return 'C';
            else return 'D';
        }

        function generateDashboard() {
            console.log('üîß Gerando dashboard...');
            
            // Remover candidatos duplicados baseado no nome normalizado
            const originalCount = analyzedData.length;
            analyzedData = removeDuplicates(analyzedData);
            console.log(`üîç Duplicatas removidas: ${originalCount} ‚Üí ${analyzedData.length} candidatos √∫nicos`);
            
            try {
                updateStats();
                console.log('‚úÖ Estat√≠sticas atualizadas');
                
                createCharts();
                console.log('‚úÖ Gr√°ficos criados');
                
                createCandidateTable();
                console.log('‚úÖ Tabela de candidatos criada');
                
                createStrategicInsights();
                console.log('‚úÖ Insights estrat√©gicos criados');
                
                createTopCandidates();
                console.log('‚úÖ Top candidatos criados');
                
                createHiringStrategy();
                console.log('‚úÖ Estrat√©gia de contrata√ß√£o criada');
                
                populateFilters();
                console.log('‚úÖ Filtros populados');
                
                setupMultiSelectFilters();
                console.log('‚úÖ Filtros multi-sele√ß√£o configurados');
                
            } catch (error) {
                console.error('‚ùå Erro ao gerar dashboard:', error);
                throw error;
            }
            
            console.log(`‚úÖ Dashboard gerado com sucesso: ${analyzedData.length} candidatos processados`);
        }

        function createHiringStrategy() {
            const categoryA = analyzedData.filter(c => c.category === 'A');
            const seniorPreparers = analyzedData.filter(c => c.profile === 'preparador' && c.experienceYears >= 15);
            const youngTalents = analyzedData.filter(c => c.age <= 30 && c.experienceYears >= 3);
            const engineers = analyzedData.filter(c => c.education === 'Superior');
            
            const strategyHtml = `
                <div class="hiring-strategy">
                    <div class="strategy-header">
                        <h2>üìã Estrat√©gia de Contrata√ß√£o Recomendada</h2>
                        <p>Baseada na an√°lise de ${analyzedData.length} candidatos qualificados</p>
                    </div>
                    
                    <div class="strategy-phases">
                        <div class="phase-card priority">
                            <div class="phase-header">
                                <h3>üöÄ FASE 1 - Contrata√ß√µes Priorit√°rias (2-3 pessoas)</h3>
                                <span class="phase-timeline">Imediato</span>
                            </div>
                            <div class="recommendations">
                                <div class="recommendation">
                                    <strong>1 Preparador Senior:</strong> 
                                    ${seniorPreparers.slice(0, 2).map(c => c.name).join(' ou ')}
                                    <div class="reason">‚Üí Lideran√ßa t√©cnica e forma√ß√£o de equipe</div>
                                </div>
                                <div class="recommendation">
                                    <strong>1 Jovem Talento:</strong> 
                                    ${youngTalents.slice(0, 2).map(c => `${c.name} (${c.age} anos)`).join(' ou ')}
                                    <div class="reason">‚Üí Renova√ß√£o e potencial de crescimento</div>
                                </div>
                                <div class="recommendation">
                                    <strong>1 Categoria A:</strong> 
                                    ${categoryA.slice(0, 2).map(c => `${c.name} (Score: ${c.score})`).join(' ou ')}
                                    <div class="reason">‚Üí M√°xima qualifica√ß√£o e versatilidade</div>
                                </div>
                            </div>
                        </div>

                        <div class="phase-card expansion">
                            <div class="phase-header">
                                <h3>üìà FASE 2 - Expans√£o da Equipe (3-4 pessoas)</h3>
                                <span class="phase-timeline">30-60 dias</span>
                            </div>
                            <div class="recommendations">
                                <div class="recommendation">
                                    <strong>Operadores Experientes:</strong> 
                                    Foco em candidatos com 10+ anos de experi√™ncia
                                    <div class="reason">‚Üí Estabilidade operacional</div>
                                </div>
                                <div class="recommendation">
                                    <strong>Profissionais Vers√°teis:</strong> 
                                    ${Math.round((analyzedData.filter(c => c.machineType === 'ambos').length / analyzedData.length) * 100)}% dos candidatos trabalham com ambas m√°quinas
                                    <div class="reason">‚Üí Flexibilidade operacional m√°xima</div>
                                </div>
                                <div class="recommendation">
                                    <strong>Forma√ß√£o Superior:</strong> 
                                    ${engineers.length} candidatos com n√≠vel superior dispon√≠veis
                                    <div class="reason">‚Üí Capacidade anal√≠tica e inova√ß√£o</div>
                                </div>
                            </div>
                        </div>

                        <div class="phase-card development">
                            <div class="phase-header">
                                <h3>üéØ FASE 3 - Desenvolvimento Cont√≠nuo</h3>
                                <span class="phase-timeline">Ongoing</span>
                            </div>
                            <div class="recommendations">
                                <div class="recommendation">
                                    <strong>Programa de Multifuncionais:</strong> 
                                    Apenas ${analyzedData.filter(c => c.profile === 'mixed').length} candidatos multifuncionais
                                    <div class="reason">‚Üí Oportunidade de desenvolvimento interno</div>
                                </div>
                                <div class="recommendation">
                                    <strong>Capacita√ß√£o T√©cnica:</strong> 
                                    ${Math.round((analyzedData.filter(c => c.education === 'Ensino M√©dio').length / analyzedData.length) * 100)}% t√™m apenas ensino m√©dio
                                    <div class="reason">‚Üí Investimento em cursos t√©cnicos/superiores</div>
                                </div>
                                <div class="recommendation">
                                    <strong>Sucess√£o e Lideran√ßa:</strong> 
                                    Preparar jovens talentos para cargos de prepara√ß√£o
                                    <div class="reason">‚Üí Continuidade e crescimento da opera√ß√£o</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="conclusion">
                        <h3>üí° Conclus√£o Executiva</h3>
                        <div class="conclusion-points">
                            <div class="conclusion-item excellent">
                                <span class="icon">‚úÖ</span>
                                <div>
                                    <strong>Pool Excelente:</strong> ${analyzedData.length} candidatos qualificados com ${Math.round(analyzedData.reduce((sum, c) => sum + c.experienceYears, 0) / analyzedData.length)} anos de experi√™ncia m√©dia
                                </div>
                            </div>
                            <div class="conclusion-item good">
                                <span class="icon">üéØ</span>
                                <div>
                                    <strong>Versatilidade:</strong> ${Math.round((analyzedData.filter(c => c.machineType === 'ambos').length / analyzedData.length) * 100)}% trabalham com ambas m√°quinas (Torno + Centro)
                                </div>
                            </div>
                            <div class="conclusion-item strategic">
                                <span class="icon">üìç</span>
                                <div>
                                    <strong>Log√≠stica Favor√°vel:</strong> ${Math.round((analyzedData.filter(c => ['V√°rzea Paulista', 'Jundia√≠', 'Campo Limpo Paulista'].includes(c.city)).length / analyzedData.length) * 100)}% concentrados na regi√£o
                                </div>
                            </div>
                            <div class="conclusion-item recommendation">
                                <span class="icon">üöÄ</span>
                                <div>
                                    <strong>Recomenda√ß√£o:</strong> Priorizar Categoria A e profissionais vers√°teis para m√°xima efici√™ncia operacional
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Inserir no final do dashboard
            const dashboard = document.getElementById('dashboard');
            dashboard.appendChild(createElementFromHTML(strategyHtml));
        }

        function removeDuplicates(candidates) {
            const seen = new Set();
            return candidates.filter(candidate => {
                // Normalizar nome para compara√ß√£o
                const normalizedName = candidate.name.toLowerCase()
                    .replace(/\s+/g, ' ')
                    .trim();
                
                if (seen.has(normalizedName) || normalizedName.length < 3) {
                    return false;
                }
                seen.add(normalizedName);
                return true;
            });
        }

        function createStrategicInsights() {
            const insightsHtml = `
                <div class="strategic-insights">
                    <div class="insights-header">
                        <h2>üéØ Insights Estrat√©gicos</h2>
                    </div>
                    <div class="insights-grid">
                        <div class="insight-card strengths">
                            <h3>‚úÖ Pontos Fortes</h3>
                            <ul>
                                <li><strong>${Math.round((analyzedData.filter(c => c.machineType === 'ambos').length / analyzedData.length) * 100)}% s√£o vers√°teis</strong> (trabalham com ambas m√°quinas)</li>
                                <li><strong>${Math.round((analyzedData.filter(c => ['V√°rzea Paulista', 'Jundia√≠', 'Campo Limpo Paulista'].includes(c.city)).length / analyzedData.length) * 100)}% est√£o na regi√£o</strong> (log√≠stica favor√°vel)</li>
                                <li><strong>Experi√™ncia s√≥lida:</strong> ${Math.round(analyzedData.reduce((sum, c) => sum + c.experienceYears, 0) / analyzedData.length)} anos de m√©dia</li>
                                <li><strong>${analyzedData.filter(c => c.education === 'Superior').length} candidatos com forma√ß√£o superior</strong></li>
                                <li><strong>Pool robusto:</strong> ${analyzedData.length} candidatos qualificados</li>
                            </ul>
                        </div>
                        <div class="insight-card attention">
                            <h3>‚ö†Ô∏è Pontos de Aten√ß√£o</h3>
                            <ul>
                                <li><strong>Idade m√©dia elevada:</strong> ${Math.round(analyzedData.reduce((sum, c) => sum + c.age, 0) / analyzedData.length)} anos - equilibrar com jovens</li>
                                <li><strong>Poucos multifuncionais:</strong> ${analyzedData.filter(c => c.profile === 'mixed').length} candidatos - oportunidade de desenvolvimento</li>
                                <li><strong>Predomin√¢ncia ensino m√©dio:</strong> ${Math.round((analyzedData.filter(c => c.education === 'Ensino M√©dio').length / analyzedData.length) * 100)}% - investir em capacita√ß√£o</li>
                                <li><strong>Especializa√ß√£o necess√°ria:</strong> equilibrar generalistas vs especialistas</li>
                            </ul>
                        </div>
                        <div class="insight-card recommendations">
                            <h3>üöÄ Recomenda√ß√µes</h3>
                            <ul>
                                <li><strong>Priorizar vers√°teis</strong> (ambas m√°quinas) para flexibilidade</li>
                                <li><strong>Equilibrar gera√ß√µes:</strong> seniors (experi√™ncia) + juniors (inova√ß√£o)</li>
                                <li><strong>Focar na regi√£o:</strong> V√°rzea Paulista/Jundia√≠ (menor deslocamento)</li>
                                <li><strong>Investir em multifuncionais:</strong> preparador + operador</li>
                                <li><strong>Valorizar forma√ß√£o t√©cnica/superior</strong> quando dispon√≠vel</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            // Inserir antes da tabela de candidatos
            const dashboard = document.getElementById('dashboard');
            const candidateTable = document.querySelector('.candidate-table');
            dashboard.insertBefore(createElementFromHTML(insightsHtml), candidateTable);
        }

        function createTopCandidates() {
            // Separar candidatos por categoria baseado no score
            const categoryA = analyzedData.filter(c => c.category === 'A').sort((a, b) => b.score - a.score);
            const categoryB = analyzedData.filter(c => c.category === 'B').sort((a, b) => b.score - a.score);
            const categoryC = analyzedData.filter(c => c.category === 'C').sort((a, b) => b.score - a.score);
            
            // Separar por perfil para an√°lise espec√≠fica
            const seniorPreparers = analyzedData.filter(c => 
                c.profile === 'preparador' && c.experienceYears >= 15
            ).sort((a, b) => b.experienceYears - a.experienceYears);
            
            const youngTalents = analyzedData.filter(c => 
                c.age <= 30 && c.experienceYears >= 3
            ).sort((a, b) => b.score - a.score);
            
            const versatileWorkers = analyzedData.filter(c => 
                c.machineType === 'ambos' && c.experienceYears >= 8
            ).sort((a, b) => b.experienceYears - a.experienceYears);

            const topCandidatesHtml = `
                <div class="top-candidates">
                    <div class="top-header">
                        <h2>üèÜ Top Candidatos por Categoria</h2>
                        <p>Sistema de pontua√ß√£o baseado em experi√™ncia, perfil, versatilidade e forma√ß√£o</p>
                    </div>
                    
                    <div class="category-tabs">
                        <button class="tab-button active" data-tab="category-a">ü•á Categoria A (${categoryA.length})</button>
                        <button class="tab-button" data-tab="category-b">ü•à Categoria B (${categoryB.length})</button>
                        <button class="tab-button" data-tab="category-c">ü•â Categoria C (${categoryC.length})</button>
                        <button class="tab-button" data-tab="senior-prep">üîß Preparadores Seniores (${seniorPreparers.length})</button>
                        <button class="tab-button" data-tab="young-talents">üåü Jovens Talentos (${youngTalents.length})</button>
                        <button class="tab-button" data-tab="versatile">üîß‚öôÔ∏è Vers√°teis (${versatileWorkers.length})</button>
                    </div>

                    <div class="tab-content active" id="category-a">
                        <h3>ü•á Categoria A - Candidatos Premium (Score 80+)</h3>
                        <div class="candidates-list">
                            ${categoryA.slice(0, 5).map((c, i) => `
                                <div class="candidate-card premium">
                                    <div class="candidate-header">
                                        <span class="rank">#${i + 1}</span>
                                        <span class="name">${c.name}</span>
                                        <span class="score">Score: ${c.score}</span>
                                    </div>
                                    <div class="candidate-details">
                                        <span class="profile ${c.profile}">${getProfileLabel(c.profile)}</span>
                                        <span class="experience">${c.experienceYears} anos exp.</span>
                                        <span class="age">${c.age} anos</span>
                                        <span class="location">${c.city || 'N/I'}</span>
                                    </div>
                                    <div class="candidate-machine">${getMachineLabel(c.machineType)}</div>
                                    ${c.strengths.length > 0 ? `<div class="strengths">${c.strengths.join(', ')}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="tab-content" id="category-b">
                        <h3>ü•à Categoria B - Candidatos S√≥lidos (Score 65-79)</h3>
                        <div class="candidates-list">
                            ${categoryB.slice(0, 5).map((c, i) => `
                                <div class="candidate-card solid">
                                    <div class="candidate-header">
                                        <span class="rank">#${i + 1}</span>
                                        <span class="name">${c.name}</span>
                                        <span class="score">Score: ${c.score}</span>
                                    </div>
                                    <div class="candidate-details">
                                        <span class="profile ${c.profile}">${getProfileLabel(c.profile)}</span>
                                        <span class="experience">${c.experienceYears} anos exp.</span>
                                        <span class="age">${c.age} anos</span>
                                        <span class="location">${c.city || 'N/I'}</span>
                                    </div>
                                    <div class="candidate-machine">${getMachineLabel(c.machineType)}</div>
                                    ${c.strengths.length > 0 ? `<div class="strengths">${c.strengths.join(', ')}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="tab-content" id="category-c">
                        <h3>ü•â Categoria C - Candidatos com Potencial (Score 50-64)</h3>
                        <div class="candidates-list">
                            ${categoryC.slice(0, 5).map((c, i) => `
                                <div class="candidate-card potential">
                                    <div class="candidate-header">
                                        <span class="rank">#${i + 1}</span>
                                        <span class="name">${c.name}</span>
                                        <span class="score">Score: ${c.score}</span>
                                    </div>
                                    <div class="candidate-details">
                                        <span class="profile ${c.profile}">${getProfileLabel(c.profile)}</span>
                                        <span class="experience">${c.experienceYears} anos exp.</span>
                                        <span class="age">${c.age} anos</span>
                                        <span class="location">${c.city || 'N/I'}</span>
                                    </div>
                                    <div class="candidate-machine">${getMachineLabel(c.machineType)}</div>
                                    ${c.strengths.length > 0 ? `<div class="strengths">${c.strengths.join(', ')}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="tab-content" id="senior-prep">
                        <h3>üîß Preparadores Seniores - Para Lideran√ßa T√©cnica</h3>
                        <div class="candidates-list">
                            ${seniorPreparers.slice(0, 5).map((c, i) => `
                                <div class="candidate-card senior">
                                    <div class="candidate-header">
                                        <span class="rank">#${i + 1}</span>
                                        <span class="name">${c.name}</span>
                                        <span class="score">Score: ${c.score}</span>
                                    </div>
                                    <div class="candidate-details">
                                        <span class="profile preparador">üîß PREPARADOR SENIOR</span>
                                        <span class="experience">${c.experienceYears} anos exp.</span>
                                        <span class="age">${c.age} anos</span>
                                        <span class="location">${c.city || 'N/I'}</span>
                                    </div>
                                    <div class="candidate-machine">${getMachineLabel(c.machineType)}</div>
                                    <div class="education">Forma√ß√£o: ${c.education}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="tab-content" id="young-talents">
                        <h3>üåü Jovens Talentos - Para Renova√ß√£o e Crescimento</h3>
                        <div class="candidates-list">
                            ${youngTalents.slice(0, 5).map((c, i) => `
                                <div class="candidate-card young">
                                    <div class="candidate-header">
                                        <span class="rank">#${i + 1}</span>
                                        <span class="name">${c.name}</span>
                                        <span class="score">Score: ${c.score}</span>
                                    </div>
                                    <div class="candidate-details">
                                        <span class="profile ${c.profile}">${getProfileLabel(c.profile)} JOVEM</span>
                                        <span class="experience">${c.experienceYears} anos exp.</span>
                                        <span class="age">${c.age} anos</span>
                                        <span class="location">${c.city || 'N/I'}</span>
                                    </div>
                                    <div class="candidate-machine">${getMachineLabel(c.machineType)}</div>
                                    <div class="potential">üí° Alto potencial de crescimento</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="tab-content" id="versatile">
                        <h3>üîß‚öôÔ∏è Profissionais Vers√°teis - M√°xima Flexibilidade</h3>
                        <div class="candidates-list">
                            ${versatileWorkers.slice(0, 5).map((c, i) => `
                                <div class="candidate-card versatile">
                                    <div class="candidate-header">
                                        <span class="rank">#${i + 1}</span>
                                        <span class="name">${c.name}</span>
                                        <span class="score">Score: ${c.score}</span>
                                    </div>
                                    <div class="candidate-details">
                                        <span class="profile ${c.profile}">${getProfileLabel(c.profile)}</span>
                                        <span class="experience">${c.experienceYears} anos exp.</span>
                                        <span class="age">${c.age} anos</span>
                                        <span class="location">${c.city || 'N/I'}</span>
                                    </div>
                                    <div class="candidate-machine">üîß‚öôÔ∏è TORNO + CENTRO DE USINAGEM</div>
                                    <div class="versatility">‚≠ê M√°xima versatilidade operacional</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            // Inserir antes da tabela de candidatos
            const dashboard = document.getElementById('dashboard');
            const candidateTable = document.querySelector('.candidate-table');
            dashboard.insertBefore(createElementFromHTML(topCandidatesHtml), candidateTable);
            
            // Adicionar funcionalidade das abas
            setupTabFunctionality();
        }

        function getProfileLabel(profile) {
            switch(profile) {
                case 'preparador': return 'üîß Preparador';
                case 'operador': return '‚öôÔ∏è Operador';
                case 'mixed': return 'üîß‚öôÔ∏è Multifuncional';
                default: return '‚ùì N√£o especificado';
            }
        }

        function createElementFromHTML(htmlString) {
            const div = document.createElement('div');
            div.innerHTML = htmlString.trim();
            return div.firstChild;
        }

        function setupTabFunctionality() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons and contents
                    tabButtons.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked button and corresponding content
                    button.classList.add('active');
                    const targetTab = button.getAttribute('data-tab');
                    document.getElementById(targetTab).classList.add('active');
                });
            });
        }

        function updateStats() {
            const total = analyzedData.length;
            const preparadores = analyzedData.filter(c => c.profile === 'preparador').length;
            const operadores = analyzedData.filter(c => c.profile === 'operador').length;
            const versateis = analyzedData.filter(c => c.machineType === 'ambos').length;
            const categoryA = analyzedData.filter(c => c.category === 'A').length;
            
            const avgAge = Math.round(analyzedData.reduce((sum, c) => sum + c.age, 0) / total);
            const avgExp = Math.round(analyzedData.reduce((sum, c) => sum + c.experienceYears, 0) / total);
            
            // Calcular concentra√ß√£o regional
            const regionalCities = ['V√°rzea Paulista', 'Jundia√≠', 'Campo Limpo Paulista'];
            const regionalCount = analyzedData.filter(c => regionalCities.includes(c.city)).length;
            const regionalPercentage = Math.round((regionalCount / total) * 100);

            document.getElementById('totalCandidates').textContent = total;
            document.getElementById('preparadorCount').textContent = preparadores;
            document.getElementById('operadorCount').textContent = operadores;
            document.getElementById('avgAge').textContent = avgAge || 0;
            document.getElementById('avgExperience').textContent = avgExp || 0;
            document.getElementById('versatileCount').textContent = versateis;
            document.getElementById('categoryACount').textContent = categoryA;
            document.getElementById('regionalCount').textContent = `${regionalPercentage}%`;
        }

        function createCharts() {
            // Gr√°fico de perfis
            const profileData = {
                labels: ['Preparador CNC', 'Operador CNC', 'Multifuncional'],
                datasets: [{
                    data: [
                        analyzedData.filter(c => c.profile === 'preparador').length,
                        analyzedData.filter(c => c.profile === 'operador').length,
                        analyzedData.filter(c => c.profile === 'mixed').length
                    ],
                    backgroundColor: ['#27ae60', '#2196f3', '#ff9800'],
                    borderWidth: 0
                }]
            };

            charts.profile = new Chart(document.getElementById('profileChart'), {
                type: 'doughnut',
                data: profileData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Gr√°fico de m√°quinas
            const machineData = {
                labels: ['Torno CNC', 'Centro de Usinagem', 'Ambos'],
                datasets: [{
                    data: [
                        analyzedData.filter(c => c.machineType === 'torno').length,
                        analyzedData.filter(c => c.machineType === 'centro').length,
                        analyzedData.filter(c => c.machineType === 'ambos').length
                    ],
                    backgroundColor: ['#e74c3c', '#9b59b6', '#34495e'],
                    borderWidth: 0
                }]
            };

            charts.machine = new Chart(document.getElementById('machineChart'), {
                type: 'pie',
                data: machineData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Gr√°fico de idades
            const ageRanges = ['18-25', '26-35', '36-45', '46+'];
            const ageData = {
                labels: ageRanges,
                datasets: [{
                    label: 'Candidatos',
                    data: [
                        analyzedData.filter(c => c.age >= 18 && c.age <= 25).length,
                        analyzedData.filter(c => c.age >= 26 && c.age <= 35).length,
                        analyzedData.filter(c => c.age >= 36 && c.age <= 45).length,
                        analyzedData.filter(c => c.age >= 46).length
                    ],
                    backgroundColor: '#3498db',
                    borderRadius: 5
                }]
            };

            charts.age = new Chart(document.getElementById('ageChart'), {
                type: 'bar',
                data: ageData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });

            // Gr√°fico de educa√ß√£o
            const educationCounts = {};
            analyzedData.forEach(c => {
                const edu = c.education || 'N√£o informado';
                educationCounts[edu] = (educationCounts[edu] || 0) + 1;
            });

            charts.education = new Chart(document.getElementById('educationChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(educationCounts),
                    datasets: [{
                        data: Object.values(educationCounts),
                        backgroundColor: ['#1abc9c', '#f39c12', '#e67e22', '#95a5a6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Gr√°fico de localiza√ß√£o
            const locationCounts = {};
            analyzedData.forEach(c => {
                const city = c.city || 'N√£o informado';
                locationCounts[city] = (locationCounts[city] || 0) + 1;
            });

            charts.location = new Chart(document.getElementById('locationChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(locationCounts),
                    datasets: [{
                        label: 'Candidatos',
                        data: Object.values(locationCounts),
                        backgroundColor: '#16a085',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });

            // Gr√°fico de experi√™ncia
            const expRanges = ['0-2 anos', '3-5 anos', '6-10 anos', '11+ anos'];
            const expData = {
                labels: expRanges,
                datasets: [{
                    label: 'Candidatos',
                    data: [
                        analyzedData.filter(c => c.experienceYears >= 0 && c.experienceYears <= 2).length,
                        analyzedData.filter(c => c.experienceYears >= 3 && c.experienceYears <= 5).length,
                        analyzedData.filter(c => c.experienceYears >= 6 && c.experienceYears <= 10).length,
                        analyzedData.filter(c => c.experienceYears >= 11).length
                    ],
                    backgroundColor: '#8e44ad',
                    borderRadius: 5
                }]
            };

            charts.experience = new Chart(document.getElementById('experienceChart'), {
                type: 'bar',
                data: expData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function createCandidateTable() {
            const table = document.getElementById('candidateTable');
            
            // Ordenar candidatos por score (melhor metodologia)
            const sortedData = [...analyzedData].sort((a, b) => b.score - a.score);
            
            table.innerHTML = `
                <div class="table-header-row">
                    <div class="header-cell">Nome e Detalhes</div>
                    <div class="header-cell">Categoria</div>
                    <div class="header-cell">Score</div>
                    <div class="header-cell">Perfil</div>
                    <div class="header-cell">M√°quina</div>
                    <div class="header-cell">Experi√™ncia</div>
                    <div class="header-cell">Idade</div>
                    <div class="header-cell">Localiza√ß√£o</div>
                </div>
                ${sortedData.map((candidate, index) => {
                    // Criar informa√ß√µes extras para mostrar entre par√™nteses
                    const extraInfo = [];
                    if (candidate.education && candidate.education !== 'Ensino M√©dio') {
                        extraInfo.push(candidate.education);
                    }
                    if (candidate.senaiCourses > 0) {
                        extraInfo.push(`${candidate.senaiCourses} cursos SENAI`);
                    }
                    if (candidate.companies.length > 0) {
                        extraInfo.push(`${candidate.companies.length} empresas`);
                    }
                    if (candidate.strengths.length > 0) {
                        extraInfo.push(...candidate.strengths);
                    }
                    
                    const extraInfoText = extraInfo.length > 0 ? ` (${extraInfo.join(', ')})` : '';
                    
                    return `
                        <div class="candidate-row ${candidate.category.toLowerCase()}" data-profile="${candidate.profile}" data-machine="${candidate.machineType}" data-city="${candidate.city}" data-category="${candidate.category}">
                            <div class="candidate-name">
                                <span class="rank-badge">#${index + 1}</span>
                                <div class="name-details">
                                    <div class="main-name">${candidate.name || 'Nome n√£o identificado'}</div>
                                    ${extraInfoText ? `<div class="extra-info">${extraInfoText}</div>` : ''}
                                    ${candidate.candidateId ? `<div class="candidate-id">ID: ${candidate.candidateId}</div>` : ''}
                                </div>
                            </div>
                            <div class="candidate-category category-${candidate.category.toLowerCase()}">
                                ${candidate.category}
                            </div>
                            <div class="candidate-score">
                                <span class="score-badge">${candidate.score}</span>
                            </div>
                            <div class="candidate-profile profile-${candidate.profile}">
                                ${candidate.profile === 'preparador' ? 'üîß Preparador' : 
                                  candidate.profile === 'operador' ? '‚öôÔ∏è Operador' : 
                                  candidate.profile === 'mixed' ? 'üîß‚öôÔ∏è Multifuncional' : '‚ùì N/E'}
                            </div>
                            <div class="machine-type">${getMachineLabel(candidate.machineType)}</div>
                            <div class="experience-years">
                                <strong>${candidate.experienceYears}</strong> anos
                            </div>
                            <div class="candidate-age">${candidate.age || '?'} anos</div>
                            <div class="candidate-city">
                                <div class="city-name">${candidate.city || 'N√£o informado'}</div>
                                ${candidate.fullAddress ? `<div class="full-address">${candidate.fullAddress}</div>` : ''}
                            </div>
                        </div>
                    `;
                }).join('')}
            `;
        }

        function getMachineLabel(type) {
            switch(type) {
                case 'torno': return 'üîß Torno CNC';
                case 'centro': return '‚öôÔ∏è Centro Usinagem';
                case 'ambos': return 'üîß‚öôÔ∏è Ambos';
                case 'nao_especificado': return '‚ùì N√£o especificado';
                default: return '‚ùì N√£o especificado';
            }
        }

        function populateFilters() {
            // Popular filtro de cidades
            const cities = [...new Set(analyzedData.map(c => c.city).filter(c => c))];
            const cityFilter = document.getElementById('cityFilter');
            
            cities.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                cityFilter.appendChild(option);
            });
        }

        function applyFilters() {
            // Esta fun√ß√£o seria implementada para filtrar os dados e atualizar os gr√°ficos
            // Por ora, deixaremos como placeholder
            console.log('Aplicando filtros...');
        }

        function showDashboard() {
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('progressBar').style.display = 'none';
            document.getElementById('analyzeBtn').disabled = false;
        }
    </script>
</body>
</html>
